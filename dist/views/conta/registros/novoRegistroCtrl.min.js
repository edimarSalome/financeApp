financeApp.controller("novoRegistroCtrl",["$scope","$sce","utils","$state","$stateParams","$filter",function(d,c,b,f,g,h){var e=this;var a=firebase.database();e.construct=function(){e.userId=1;d.registro={tipo:g.tipo,categoria:null,valor:0,descricao:null,data:new Date(),conta:null,situacao:"Realizado"};e.getContas()};d.registrar=function(){if(e.validarRegistro()){d.registro.data=h("date")(d.registro.data,"MM-dd-yyyy");if(d.registro.tipo==="entrada"){var i=e.getSaldoAtual(d.registro.conta)+d.registro.valor;a.ref("/contas/"+e.userId+"/"+d.registro.conta+"/saldo").set(i);a.ref("/registros/"+d.registro.conta).push(d.registro)}else{if(d.registro.tipo==="despesa"){var i=e.getSaldoAtual(d.registro.conta)-d.registro.valor;a.ref("/contas/"+e.userId+"/"+d.registro.conta+"/saldo").set(i);a.ref("/registros/"+d.registro.conta).push(d.registro)}}f.go("principal")}};e.validarRegistro=function(){d.invalidForm=false;d.msg="Informe todos os campos";var i=0;if(!d.registro.tipo){i++}if(!d.registro.categoria){i++}if(!d.registro.valor){i++}if(!d.registro.descricao){i++}if(!d.registro.data){i++}if(!d.registro.conta){i++}if(!d.registro.situacao){i++}if(i){d.invalidForm=true;return false}else{return true}};e.getContas=function(){a.ref("/contas").orderByChild("/"+e.userId).limitToFirst(1).once("value",function(i){d.$apply(function(){e.contas=b.firebaseArray(i);d.charged=true})})};e.getSaldoAtual=function(i){var j=null;e.contas.forEach(function(l,k){if(l.id===i){j=l.saldo}});return j};e.construct()}]);